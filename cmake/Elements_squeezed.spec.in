# -*- rpm-spec -*-

Summary:        @CPACK_PACKAGE_NAME@ Project
Name:           @CPACK_RPM_PACKAGE_NAME@
Version:        @CPACK_RPM_PACKAGE_VERSION@
Release:        @CPACK_PACKAGE_RELEASE@%{?dist}
License:        Public Domain
Group:          Development/Tools
Source:         @CPACK_RPM_PACKAGE_NAME@-@CPACK_RPM_PACKAGE_VERSION@.tar.gz
Vendor:         @CPACK_PACKAGE_VENDOR@

%bcond_without squeeze
%bcond_with doc

%global __python @PYTHON_EXECUTABLE@ 

@CPACK_RPM_AUTOREQ_LINE@

@RPM_DEVEL_BUILDDEP_SYS_LINES@
@RPM_DEVEL_BUILDDEP_LINES@
@RPM_DOC_BUILDDEP_LINES@

@RPM_DEP_SYS_LINES@
@RPM_DEP_LINES@
Requires(post):    /sbin/ldconfig
Requires(postun):  /sbin/ldconfig

%define bin_tag @CPACK_SYSTEM_NAME@
%define _prefix @CPACK_PACKAGING_INSTALL_PREFIX@
%define build_dir_name @BUILD_SUBDIR@
%define libdir %{_prefix}/@CMAKE_LIB_INSTALL_SUFFIX@
%define pydir %{_prefix}/@PYTHON_INSTALL_SUFFIX@
%define pydyndir %{_prefix}/@PYTHON_DYNLIB_INSTALL_SUFFIX@
%define scriptsdir %{_prefix}/@SCRIPT_INSTALL_SUFFIX@
%define cmakedir %{_prefix}/@CMAKE_INSTALL_SUFFIX@
%define makedir %{_prefix}/@MAKE_INSTALL_SUFFIX@
%define confdir %{_prefix}/@CONF_INSTALL_SUFFIX@
%define auxdir %{_prefix}/@AUX_INSTALL_SUFFIX@
%define docdir %{_prefix}/@DOC_INSTALL_SUFFIX@
%define xmldir %{_prefix}/@XML_INSTALL_SUFFIX@

%define debug_package %{nil}

%description
@CPACK_RPM_PACKAGE_DESCRIPTION@

%package devel
Group:  Development/Libraries
Summary: The development part of the %{name} package
@RPM_DEVEL_DEP_SYS_LINES@
Requires: %{name} = %{version}-%{release}
@RPM_DEVEL_DEP_LINES@

%description devel
The development part of the %{name} package.

%package debuginfo
Summary: Debug information for package %{name}
Requires: %{name} = %{version}-%{release}
@RPM_DEBUGINFO_DEP_LINES@

%description debuginfo
Debug information for package %{name}

%if %{with doc}
%package doc
Summary: Documentation for package %{name}
Requires: %{name}-devel = %{version}-%{release}

%description doc
Documentation for package %{name}
%endif

%prep
%setup -q

%build
export BINARY_TAG=%{bin_tag}
export VERBOSE=1
%__mkdir -p $RPM_BUILD_DIR/$BINARY_TAG
@CPACK_CMAKE_PREFIX_PATH_LINE@
cd $RPM_BUILD_DIR/$BINARY_TAG
%cmake @CPACK_EXTRA_CMAKEFLAGS@ $RPM_BUILD_DIR/%{name}-%{version}
%__make VERBOSE=1 %{?_smp_mflags} all

%install
export BINARY_TAG=%{bin_tag}
export VERBOSE=1
@CPACK_CMAKE_PREFIX_PATH_LINE@
cd $RPM_BUILD_DIR/$BINARY_TAG
%__make install VERBOSE=1 DESTDIR=$RPM_BUILD_ROOT

%check
export CTEST_OUTPUT_ON_FAILURE=1
export ELEMENTS_NAMING_DB_URL=https://pieclddj00.isdc.unige.ch/elementsnaming
export BINARY_TAG=%{bin_tag}
export VERBOSE=1
@CPACK_CMAKE_PREFIX_PATH_LINE@
cd $RPM_BUILD_DIR/$BINARY_TAG
%__make test

%clean
rm -rf $RPM_BUILD_ROOT

%postun
/sbin/ldconfig

@CPACK_RPM_REGULAR_FILES@

@CPACK_RPM_DEVEL_FILES@

@CPACK_RPM_DEBINFO_FILES@

%if %{with doc}
@CPACK_RPM_DOC_FILES@
%endif


@CPACK_RPM_CHANGELOG@



